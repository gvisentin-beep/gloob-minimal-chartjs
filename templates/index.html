<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gloob minimal charts</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui, Arial; margin: 20px; }
    .row { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    canvas { max-width: 1100px; }
  </style>
</head>
<body>
  <h2>Portafoglio vs Benchmark (LS80)</h2>

  <div class="row">
    <label>Frequenza:</label>
    <select id="freq">
      <option value="monthly" selected>Mensile</option>
      <option value="weekly">Settimanale</option>
      <option value="daily">Giornaliera</option>
    </select>
    <button id="reload">Aggiorna</button>
    <span id="info"></span>
  </div>

  <p></p>
  <canvas id="chart" height="120"></canvas>

  <script>
    let chart;

    async function load() {
      const freq = document.getElementById("freq").value;
      const res = await fetch(`/api/combined?freq=${encodeURIComponent(freq)}`);
      const data = await res.json();

      if (data.error) {
        document.getElementById("info").textContent = "ERRORE: " + data.error;
        return;
      }

      document.getElementById("info").textContent =
        `Base: ${data.base_date} â€¢ Punti: ${data.points}`;

      const ctx = document.getElementById("chart").getContext("2d");

      const cfg = {
        type: "line",
        data: {
          labels: data.labels,
          datasets: [
            { label: "Benchmark (LS80)", data: data.series.benchmark, tension: 0.2 },
            { label: "Portafoglio", data: data.series.portfolio, tension: 0.2 }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: "index", intersect: false },
          plugins: { legend: { position: "top" } },
          scales: { y: { ticks: { callback: (v)=> v.toFixed(0) } } }
        }
      };

      if (chart) chart.destroy();
      chart = new Chart(ctx, cfg);
    }

    document.getElementById("reload").addEventListener("click", load);
    load();
  </script>
</body>
</html>
